
<html>
<head th:replace="fragments_others_head2" :: head></head>

<body>
	<div id="layout-wrapper">

		<div th:replace="fragments_others_header3" :: header></div>

		<div th:replace="fragments_others_menu" :: menu></div>

		<div class="main-content">
			<div class="page-content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">
							<div
								class="page-title-box d-sm-flex align-items-center justify-content-between">
								<h4 class="mb-sm-0"></h4>
								<div class="page-title-right">
									<ol class="breadcrumb m-0">
										<li class="breadcrumb-item"><a
											href="javascript: void(0);">Dash board</a></li>
										<li class="breadcrumb-item active">Update License</li>
									</ol>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-lg-12">
							<div class="card">
								<div class="card-header bg-primary pb-2 pt-2">
									<div class="d-flex justify-content-between">
										<h4 class="card-title text-white mb-0 pt-2">Edit Sub Aua
											License Key</h4>
									</div>
								</div>
								<div class="card-body">
									<div id="suspectedAadhaar">
										<form class="row g-3 needs-validation" novalidate id="validation-form" th:action="@{'/'+${details.srno}}"
											th:object="${details}" method="GET">
											<div class="alert alert-primary" role="alert"
												th:text="${success}" th:if="${success}"></div>
											<div class="alert alert-danger" role="alert"
												th:text="${error}" th:if="${error}"></div>

											
											<div class="col-md-4">
												<label for="validationCustom01" class="form-label">SUB
													AUA Name </label> <input type="text" th:field="*{subAuaName}"
													class="form-control" id="SUB_AUA_NAME"
													placeholder="SUB AUA NAME" required readonly="readonly">
											</div>
											<div class="col-md-4">
												<label for="validationCustom01" class="form-label">SUB
													AUA Code </label> <input type="text" th:field="*{subAuaCode}"
													class="form-control" id="SUB_AUA_CODE"
													placeholder="SUB_AUA CODE" required readonly="readonly">
											</div>
											
											<div class="col-md-4">
												<label for="SUB_AUA_LK" class="form-label">SUB AUA LK</label>
												<div class="input-group">
													<input type="text" th:field="*{subAuaLk}" class="form-control" id="SUB_AUA_LK" placeholder="SUB AUA LK"
														required>
													<button type="button" class="btn btn-secondary viewBtn" value="VIEW" onclick="openOtpModal('SUB_AUA_LK')"><i class="ri-eye-fill fs-5"> <i></i></i></button>
												</div>
											</div>
											
											<div class="col-md-4">
												<label for="validationCustom01" class="form-label">KUA
													CODE </label> <input type="text" th:field="*{kuaCode}"
													class="form-control" id="KUA_CODE" placeholder="KUA CODE"
													required>
											</div>
											<div class="col-md-4">
												<label for="KUA_LK" class="form-label">KUA LK</label>
												<div class="input-group">
													<input type="text" th:field="*{kuaLk}" class="form-control" id="KUA_LK" placeholder="KUA LK" required>
													<button type="button" class="btn btn-secondary viewBtn" value="VIEW" onclick="openOtpModal('KUA_LK')"><i class="ri-eye-fill fs-5"> <i></i></i></button>
												</div>
											</div>
											<div class="col-md-4">
												<label for="validationCustom01" class="form-label">EXPIRY
													DATE(SUBAUA LK) </label> <input type="date" th:field="*{expiryDate}"
													class="form-control flatpickr-input active"
													data-provider="flatpickr" data-date-format="Y-m-d"
													id="EXPIRY_DATE" placeholder="EXPIRY DATE" required>
												<!-- readonly="readonly" -->
											</div>

											<!-- <div class="col-md-4">
												<label for="validationCustom01" class="form-label">KUA_LK_CODE
												</label> <input type="text" th:field="*{kukLkCode}"
													class="form-control" id="KUA_LK_CODE" placeholder="" required>
											</div> -->
											<div class="col-md-4">
												<label for="validationCustom01" class="form-label">STATUS </label> 
											<select class="form-select mb-3"
													aria-label="Default select example form-control"
													id="ACTIVE" name="ACTIVE"
													th:field="*{status}" required>
													<option th:value="1">ACTIVE</option>
													<option th:value="0"> DE-ACTIVE</option>

												</select>
											</div>
											
											<div class="col-12">
												<button class="btn btn-primary submitBtn" type="submit" onclick="openModalSubmitBtn()" value="SUBMIT">Submit
													</button>
											</div>

										</form>

									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div th:replace="fragments_others_footer" :: footer></div>

	</div>
	
		<div class="modal fade" id="otpPopupP1" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h5 class="modal-title text-white" id="exampleModalLongTitle" >XXXXXXXX5845</h5>
                <button type="button" class="cancel" data-dismiss="modal" aria-label="Close" onclick="closeandCancelModal()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <form id="formOtp">
                    
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="popupbox11">
                                <input type="checkbox" id="agree1" name="agree1" value="Bike" onclick="concernCheckbox(this)">
                                <label for="agree1">  I hereby state that i have no objection in authenticating myself with AADHAAR based authentication system and consent to providing my AADHAAR Number, and OTP for AADHAAR based Authentication. I also give my explicit consent for accessing the mobile number and email address from AADHAAR System. </label>
                            </div>
                            <div class="otpinputbox1">
                                <input type="text" id="otp" name="otp" maxlength="6" style="display: none;" placeholder="OTP (Time-Based OTP)">
                                <label class="left10minutes" style="display: none;">Note : AADHAAR OTP will be valid only for 10 minutes.</label><br>
                                <label class="opt2minutes" style="display: none;">Resend OTP <span class="otp-countdown" id="timer-countdown">02:00</span></label>
                            </div>
                        </div>
                        <div class="flexbuttonOTP">
                            <button type="button" class="btn btn-primary" id="sendOTP1" onclick="sendOtp()" disabled>Send OTP</button>
                            <button type="button" class="btn btn-primary" id="OTPvalidatebtn" style="display: none;" onclick="validateOtp()">Validate OTP</button>
                            <button type="button" class="btn btn-primary" id="resentOTP" style="display: none;" onclick="resendOtp()">ReSend OTP</button>
                            <button type="button" class="btn btn-primary cancel" data-dismiss="modal" onclick="closeandCancelModal()">Cancel</button>
                           <input type="text" id="txn" name="txn" style="display: none;">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


	<button onclick="topFunction()" class="btn btn-danger btn-icon"
		id="back-to-top">
		<i class="ri-arrow-up-line"></i>
	</button>
	<script src="../../assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="../assets/libs/feather-icons/feather.min.js"></script>
	<script src="../assets/js/jquery-3.5.1.js"></script>
	<script src="../assets/js/jquery.dataTables.min.js"></script>
	<script src="../assets/js/dataTables.bootstrap5.min.js"></script>
	<script type="text/javascript"
		src="../assets/js/dataTables.fixedHeader.min.js"></script>
	<script type="text/javascript"
		src="../assets/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" src="../assets/js/jszip.min.js"></script>
	<script type="text/javascript" src="../assets/js/buttons.html5.min.js"></script>
	<script src="../assets/js/app.js"></script>
	<script src="assets/js/otpValidation.js"></script>
	
	

	<!-- <script>
		// Example starter JavaScript for disabling form submissions if there are invalid fields
		(function() {
			'use strict'

			// Fetch all the forms we want to apply custom Bootstrap validation styles to
			var forms = document.querySelectorAll('.needs-validation')

			// Loop over them and prevent submission
			Array.prototype.slice.call(forms).forEach(function(form) {
				form.addEventListener('submit', function(event) {
					if (!form.checkValidity()) {
						event.preventDefault()
						event.stopPropagation()
					}

					form.classList.add('was-validated')
				}, false)
			})
		})()
	</script> -->
				<script>
			    $(document).ready(function() {
			        $('select[name="country"]').on('change', function() {
			            var country_id = $(this).val();
			            if (country_id) {
			                $.ajax({
			                    url: "{{url('/getStates/')}}/" + country_id,
			                    type: "GET",
			                    dataType: "json",
			                    success: function(data) {
			                        console.log(data);
			                        $('select[name="state"]').empty();
			                        $.each(data, function(key, value) {
			                            $('select[name="state"]').append(
			                                '<option value="' + key + '">' + value + '</option>'
			                            );
			                        });
			                    }
			                });
			            } else {
			                $('select[name="state"]').empty();
			            }
			        });
			    });
			</script>
			
			<script>
			    var topFunction = function() {
			        window.scrollTo(0, 0);
			    };
			</script>

		
		
		<script>
			
	    let fieldIdtoToggle;		
	    function openOtpModal(fieldId)	{
			requestFor = $('.viewBtn').val();
			fieldIdtoToggle = fieldId
			$('#otpPopupP1').modal('show');
		}	
		
		function validateOtp() {
			
	    var otpValue = $("#otp").val();
		if (otpValue === "" || !$.isNumeric(otpValue)) {
			alert("Please enter a valid number OTP.");
		} else {
			$.ajax({
				
			url: '/OTPAuthentication?OTP=' + otpValue,
			method: 'POST',
			cache: false,  
			contentType: 'application/json', // Set the content type
			success: function(response) {
									if(response.auth.status == 'Y' || response.auth.status == 'y'){
										if(requestFor == 'VIEW') {
											toggleMask();
											alert('OTP Authenticated Successfully ');
										} else {
											document.getElementById('validation-form').submit();
											alert('OTP Authenticated Successfully ');
										}
										
										closeandCancelModal();
									} else {
										alert(response.message);
									}
	
			},
			error: function(xhr, status, error) {
				alert("Interanal Server Error");
			}
		});
		
		}
	}
		
        function toggleMask() {
			
			
			var field = document.getElementById(fieldIdtoToggle);
			var button = field.nextElementSibling;
            var field = document.getElementById(fieldIdtoToggle);
            var icon = field.nextElementSibling.querySelector('i');

            if (field.type === "password") {
                field.type = "text";
               
            } else {
                field.type = "password";
                
            }
        }  

        $(document).ready(function() {
            // Initialize the fields to be masked
            $('#SUB_AUA_LK').attr('type', 'password');
            $('#KUA_LK').attr('type', 'password');
        });
        
        let requestFor;
        function openModalSubmitBtn(){
			requestFor = $('.submitBtn').val();
			event.preventDefault();
			$('#otpPopupP1').modal('show');
		}
    </script>
</body>
</html>
